# Village Builder Game

Простая градостроительная игра на Phaser.js с системой рабочих, зданий и ресурсов. Менеджеры и сущности связаны через единый `GameRuntime` (scene services), логика рабочих — на XState, есть unit-тесты.

## Возможности

- **Сетка 100x100** для строительства
- **Система рабочих** с state machine (IDLE, PRODUCING, CARRYING, RETURNING)
- **Поиск путей** с помощью EasyStar.js - рабочие обходят здания
- **Здания:**
  - Замок (центр деревни)
  - Склад (хранение ресурсов)
  - Очаг (место появления рабочих)
  - Теплица (производство помидоров за 2 секунды)
- **UI:**
  - Отображение ресурсов сверху
  - Контроль скорости игры (x1, x2, x3, x5, x7)
  - Панель строительства снизу
 - **Архитектура:** сервис-контейнер (`GameRuntime`) + чистые FSM на XState
 - **Тесты:** Vitest для логики FSM

## Архитектура

### Менеджеры
- `GridManager` - управление сеткой и проверка свободных клеток
- `PathfindingManager` - интеграция EasyStar.js для поиска путей
- `ResourceManager` - учет ресурсов
- `BuildingManager` - управление зданиями
- `WorkerManager` - управление рабочими
- `UIManager` - интерфейс игры

### Сущности
- `Building` - базовый класс для зданий
- `Castle`, `Storage`, `Campfire`, `Greenhouse` - конкретные типы зданий
- `Worker` - рабочий с state machine

### FSM рабочих (XState)
Чистая машина состояний (`src/core/WorkerStateMachine.js`) без Phaser-зависимостей. Команды/сайд-эффекты (поиск пути, доставка ресурса) инъектируются через `Worker`, что делает логику тестируемой.

## Запуск

1. Установить зависимости:
```bash
npm install
```

2. Запустить сервер разработки:
```bash
npm start
```

3. Открыть браузер:
```
http://localhost:8000
```

4. Запустить тесты:
```bash
npm test
```

## Как играть

1. Нажмите на кнопку "Теплица" снизу, чтобы построить теплицу
2. Свободный рабочий автоматически привяжется к теплице
3. Рабочий начнет производить помидоры и носить их на склад
4. Используйте кнопки x1, x2, x3, x5, x7 для изменения скорости игры

## Цикл работы рабочего

1. **PRODUCING** - рабочий ждет, пока ресурс вырастет в здании
2. **CARRYING_TO_STORAGE** - несет ресурс на склад
3. **RETURNING_TO_BUILDING** - возвращается в здание
4. Повторяется с шага 1

## Расширение

Архитектура спроектирована для легкого добавления:
- Новых типов зданий (наследуйте от `Building`)
- Новых типов ресурсов (добавьте в `CONSTANTS.RESOURCE_TYPES`)
- Новых состояний рабочих (добавьте в state machine)
